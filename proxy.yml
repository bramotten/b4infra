# networks:
#   net:
#     driver: bridge


secrets:
  fullchain:
    file: ./secrets/b5nine.com-fullchain.pem
  privkey:
    file: ./secrets/b5nine.com-privkey.pem

services:
  caddy:
    # image: iarekylew00t/caddy-cloudflare:latest
    image: caddy/caddy:2.9-alpine
    container_name: caddy
    # restart: unless-stopped
    cap_drop:
      - ALL
    cap_add:
      - NET_ADMIN
      - NET_BIND_SERVICE # If binding to ports <1024
    ports:
      - 0.0.0.0:80:80/tcp # I'm probably 100.120.70.64
      - 0.0.0.0:443:443
    volumes:
      - ./config/caddy:/etc/caddy:z
      - ./data/caddy:/var/log:z
    secrets:
      - privkey
      - fullchain
  
  authelia:
    image: authelia/authelia:latest
    container_name: authelia
    # restart: unless-stopped
    # expose:
    #   - 9097
    ports:
      - "9097:9097"
    # networks:
    #   - net
    environment:
      - TZ=Europe/Amsterdam
    volumes:
      - ./config/authelia:/config:z
    secrets:
      - privkey
      - fullchain

  redis:
    image: redis:alpine
    container_name: redis
    # restart: unless-stopped
    volumes:
      - ./data/redis:/data:z
    expose:
      - 6379
    # networks:
    #   - net
    environment:
      - TZ=Europe/Amsterdam